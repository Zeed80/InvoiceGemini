# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ TrOCR

## üéØ –û–±–∑–æ—Ä

–ú–æ–¥—É–ª—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ TrOCR –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è Microsoft TrOCR (Transformer-based Optical Character Recognition) –º–æ–¥–µ–ª–µ–π. 

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üîß –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- **üìÑ –ò–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å—á–µ—Ç–æ–≤** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç JSON —Ñ–∞–π–ª—ã —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ InvoiceGemini
- **üìÅ –ò–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –ø–∞–ø–æ–∫ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏
- **üé® –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—Ç–∞—Å–µ—Ç** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- **üìã –ò–∑ –≥–æ—Ç–æ–≤—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π** - –ò–º–ø–æ—Ä—Ç –≤–Ω–µ—à–Ω–∏—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤

### ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π TrOCR (base/large, printed/handwritten)
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ì–∏–±–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/validation/test
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### üîç –ö–∞—á–µ—Å—Ç–≤–æ
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

1. –û—Ç–∫—Ä–æ–π—Ç–µ InvoiceGemini
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **–ú–µ–Ω—é ‚Üí –û–±—É—á–µ–Ω–∏–µ ‚Üí üìä TrOCR –î–∞—Ç–∞—Å–µ—Ç**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
5. –ù–∞–∂–º–∏—Ç–µ **"üöÄ –°–æ–∑–¥–∞—Ç—å –¥–∞—Ç–∞—Å–µ—Ç"**

### 2. –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.training.trocr_dataset_preparator import (
    TrOCRDatasetPreparator, 
    TrOCRDatasetConfig
)

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
config = TrOCRDatasetConfig(
    model_name="microsoft/trocr-base-printed",
    max_target_length=128,
    image_size=(384, 384),
    enable_augmentation=True
)

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ—Ä–∞
preparator = TrOCRDatasetPreparator(config)

# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞
datasets = preparator.prepare_synthetic_dataset(
    output_path="data/my_trocr_dataset",
    num_samples=10000
)
```

## üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

### –¢–∏–ø 1: –ò–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å—á–µ—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ InvoiceGemini –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è TrOCR –¥–∞—Ç–∞—Å–µ—Ç–∞.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–∞–ø–∫–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ —Å—á–µ—Ç–æ–≤
- JSON —Ñ–∞–π–ª —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ InvoiceGemini

**–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
```
invoices/
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ invoice_001.png
‚îÇ   ‚îú‚îÄ‚îÄ invoice_002.jpg
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ annotations.json
```

**–§–æ—Ä–º–∞—Ç –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π:**
```json
[
  {
    "image_file": "invoice_001.png",
    "extracted_data": {
      "invoice_number": "INV-2023-001",
      "date": "2023-01-15",
      "supplier": "–û–û–û –ü–æ—Å—Ç–∞–≤—â–∏–∫",
      "total_amount": "15000.00"
    }
  }
]
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –í—ã–±–µ—Ä–∏—Ç–µ "–ò–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å—á–µ—Ç–æ–≤ (JSON)"
2. –£–∫–∞–∂–∏—Ç–µ –ø–∞–ø–∫—É —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
3. –í—ã–±–µ—Ä–∏—Ç–µ JSON —Ñ–∞–π–ª —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏
4. –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞—Å—Ç –ø–∞—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-—Ç–µ–∫—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è

### –¢–∏–ø 2: –ò–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç –ø–∞–ø–∫—É —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```
dataset/
‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ img001.jpg
‚îÇ   ‚îú‚îÄ‚îÄ img002.png
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ annotations.txt    # –∏–ª–∏ .json, .csv
```

**–§–æ—Ä–º–∞—Ç—ã –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π:**

**TXT —Ñ–æ—Ä–º–∞—Ç:**
```
img001.jpg    –°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞ ‚Ññ 12345
img002.png    –û–û–û "–†–æ–º–∞—à–∫–∞"
```

**JSON —Ñ–æ—Ä–º–∞—Ç:**
```json
{
  "img001.jpg": "–°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞ ‚Ññ 12345",
  "img002.png": "–û–û–û \"–†–æ–º–∞—à–∫–∞\""
}
```

**CSV —Ñ–æ—Ä–º–∞—Ç:**
```csv
image,text
img001.jpg,"–°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞ ‚Ññ 12345"
img002.png,"–û–û–û ""–†–æ–º–∞—à–∫–∞"""
```

### –¢–∏–ø 3: –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—Ç–∞—Å–µ—Ç

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Ç–µ–∫—Å—Ç–æ–º –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–∞–∑–ª–∏—á–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã –∏ —Ä–∞–∑–º–µ—Ä—ã
- –°–ª—É—á–∞–π–Ω—ã–µ —Ñ–æ–Ω—ã –∏ —Ü–≤–µ—Ç–∞  
- –ò—Å–∫–∞–∂–µ–Ω–∏—è –∏ —à—É–º
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ (100 - 100,000)
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–π

**–ü—Ä–∏–º–µ—Ä –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤:**
```python
russian_texts = [
    "–û–û–û \"–†–æ–º–∞—à–∫–∞\"",
    "–°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞ ‚Ññ",
    "–î–∞—Ç–∞:",
    "–ü–æ—Å—Ç–∞–≤—â–∏–∫:",
    "–ù–î–° 20%:",
    "–ò—Ç–æ–≥–æ:"
]
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```python
config = TrOCRDatasetConfig(
    # –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å
    model_name="microsoft/trocr-base-stage1",  # –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è fine-tuning
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–∫—Å—Ç–∞
    max_target_length=128,           # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç–æ–∫–µ–Ω–æ–≤
    min_text_length=1,               # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–∏–º–≤–æ–ª–æ–≤
    max_text_length=200,             # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–∏–º–≤–æ–ª–æ–≤
    
    # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    image_size=(384, 384),           # –†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    min_image_size=(32, 32),         # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    
    # –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
    enable_augmentation=True,
    brightness_range=(0.7, 1.3),
    contrast_range=(0.8, 1.2),
    gaussian_blur_prob=0.3
)
```

### –ú–æ–¥–µ–ª–∏ TrOCR

| –ú–æ–¥–µ–ª—å | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ |
|--------|----------|--------------|
| `trocr-base-stage1` | üéØ **–ë–∞–∑–æ–≤–∞—è** –¥–ª—è fine-tuning | –õ—É—á—à–∏–π –≤—ã–±–æ—Ä –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö |
| `trocr-base-printed` | üìÑ –ü–µ—á–∞—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç | –î–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Å—á–µ—Ç–æ–≤ |
| `trocr-base-handwritten` | ‚úçÔ∏è –†—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç | –î–ª—è —Ä—É–∫–æ–ø–∏—Å–Ω—ã—Ö —Ñ–æ—Ä–º |
| `trocr-large-printed` | üìÑ –ë–æ–ª—å—à–∞—è –¥–ª—è –ø–µ—á–∞—Ç–Ω–æ–≥–æ | –ë–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–∞—è |
| `trocr-large-handwritten` | ‚úçÔ∏è –ë–æ–ª—å—à–∞—è –¥–ª—è —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å |

### –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

| –†–∞–∑–º–µ—Ä | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | –ü–∞–º—è—Ç—å | –°–∫–æ—Ä–æ—Å—Ç—å |
|--------|------------|--------|----------|
| 224√ó224 | üèÉ –ë—ã—Å—Ç—Ä–æ–µ –æ–±—É—á–µ–Ω–∏–µ | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è |
| 384√ó384 | ‚öñÔ∏è **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π** | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω—è—è |
| 448√ó448 | üîç –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç | –í—ã—Å–æ–∫–∞—è | –ù–∏–∑–∫–∞—è |
| 512√ó512 | üìä –°–ª–æ–∂–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã | –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è | –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è |

## üîç –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –∫–∞—á–µ—Å—Ç–≤–æ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

- ‚úÖ –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ‚úÖ –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- ‚úÖ –§–æ—Ä–º–∞—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ)
- ‚úÖ –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π
- ‚úÖ –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ (UTF-8)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É

**–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–µ –º–µ–Ω–µ–µ 32√ó32 –ø–∏–∫—Å–µ–ª–µ–π
- –ß–µ—Ç–∫–∏–µ, –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, BMP, TIFF

**–¢–µ–∫—Å—Ç—ã:**
- –î–ª–∏–Ω–∞ –æ—Ç 1 –¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–î–∞—Ç–∞—Å–µ—Ç:**
- –ú–∏–Ω–∏–º—É–º 100 –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
- –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏–Ω —Ç–µ–∫—Å—Ç–∞
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Å—Ç–∏–ª–µ–π –∏ —à—Ä–∏—Ñ—Ç–æ–≤

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–∞–ø–æ–∫

```
output_dataset/
‚îú‚îÄ‚îÄ train/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 000001.jpg
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 000002.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ annotations.json
‚îÇ   ‚îî‚îÄ‚îÄ dataset.pt         # PyTorch Dataset
‚îú‚îÄ‚îÄ validation/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ annotations.json
‚îÇ   ‚îî‚îÄ‚îÄ dataset.pt
‚îú‚îÄ‚îÄ test/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ annotations.json
‚îÇ   ‚îî‚îÄ‚îÄ dataset.pt
‚îî‚îÄ‚îÄ metadata.json          # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–∞—Ç–∞—Å–µ—Ç–∞
```

### –§–æ—Ä–º–∞—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

```json
{
  "config": {
    "model_name": "microsoft/trocr-base-stage1",
    "max_target_length": 128,
    "image_size": [384, 384],
    "enable_augmentation": true
  },
  "statistics": {
    "total_samples": 1000,
    "splits": {
      "train": 800,
      "validation": 100, 
      "test": 100
    },
    "text_lengths": {
      "min": 5,
      "max": 45,
      "avg": 22.3
    }
  },
  "created_at": "2025-01-17T10:30:00",
  "transformers_available": true
}
```

## üîß –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

```python
from app.training.trocr_dataset_preparator import (
    TrOCRDatasetPreparator,      # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å
    TrOCRDatasetConfig,          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    TrOCRCustomDataset,          # PyTorch Dataset
    create_synthetic_trocr_dataset,  # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
    create_trocr_dataset_from_invoices  # –ò–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å—á–µ—Ç–æ–≤
)
```

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

#### –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Å—á–µ—Ç–æ–≤

```python
datasets = create_trocr_dataset_from_invoices(
    images_folder="data/invoices/images",
    annotations_file="data/invoices/annotations.json",
    output_path="data/trocr_invoice_dataset"
)
```

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

```python
config = TrOCRDatasetConfig(
    model_name="microsoft/trocr-base-printed",
    enable_augmentation=True
)

datasets = create_synthetic_trocr_dataset(
    output_path="data/synthetic_trocr",
    num_samples=5000,
    config=config
)
```

#### –ó–∞–≥—Ä—É–∑–∫–∞ –≥–æ—Ç–æ–≤–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

```python
preparator = TrOCRDatasetPreparator()

# –ó–∞–≥—Ä—É–∑–∫–∞ split'–∞
train_dataset = preparator.load_prepared_dataset(
    "data/my_trocr_dataset", 
    split="train"
)

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞—Ç–∞—Å–µ—Ç–µ
info = preparator.get_dataset_info("data/my_trocr_dataset")
print(f"–í—Å–µ–≥–æ –ø—Ä–∏–º–µ—Ä–æ–≤: {info['statistics']['total_samples']}")
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ PyTorch

```python
from torch.utils.data import DataLoader

# –°–æ–∑–¥–∞–Ω–∏–µ DataLoader
train_loader = DataLoader(
    train_dataset, 
    batch_size=8, 
    shuffle=True,
    num_workers=2
)

# –ò—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –±–∞—Ç—á–∞–º
for batch in train_loader:
    pixel_values = batch["pixel_values"]  # [B, C, H, W]
    labels = batch["labels"]              # [B, seq_len]
    
    # –í–∞—à –∫–æ–¥ –æ–±—É—á–µ–Ω–∏—è...
```

## üé® –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–π

```python
config = TrOCRDatasetConfig(
    enable_augmentation=True,
    
    # –¶–≤–µ—Ç–æ–≤—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è
    brightness_range=(0.7, 1.3),      # –Ø—Ä–∫–æ—Å—Ç—å ¬±30%
    contrast_range=(0.8, 1.2),        # –ö–æ–Ω—Ç—Ä–∞—Å—Ç ¬±20%
    saturation_range=(0.8, 1.2),      # –ù–∞—Å—ã—â–µ–Ω–Ω–æ—Å—Ç—å ¬±20%
    hue_range=(-0.1, 0.1),            # –û—Ç—Ç–µ–Ω–æ–∫ ¬±10%
    
    # –†–∞–∑–º—ã—Ç–∏–µ
    gaussian_blur_prob=0.3,           # 30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
    gaussian_blur_kernel=(3, 7),      # –†–∞–∑–º–µ—Ä —è–¥—Ä–∞ 3-7
    gaussian_blur_sigma=(0.1, 2.0)    # –°–∏–≥–º–∞ 0.1-2.0
)
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è–º

**–î–ª—è –ø–µ—á–∞—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:**
- –£–º–µ—Ä–µ–Ω–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è
- –ù–µ–±–æ–ª—å—à–æ–µ —Ä–∞–∑–º—ã—Ç–∏–µ (–∏–º–∏—Ç–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
- –ë–µ–∑ –ø–æ–≤–æ—Ä–æ—Ç–æ–≤ (—Ç–µ–∫—Å—Ç –≤—Å–µ–≥–¥–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π)

**–î–ª—è —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞:**
- –ë–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è
- –ò–º–∏—Ç–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω–æ–≥–æ –æ—Å–≤–µ—â–µ–Ω–∏—è
- –õ–µ–≥–∫–∏–µ –¥–µ—Ñ–æ—Ä–º–∞—Ü–∏–∏

**–î–ª—è —Å—á–µ—Ç–æ–≤ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:**
- –ò–º–∏—Ç–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏—è
- –†–∞–∑–ª–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è –æ—Å–≤–µ—â–µ–Ω–∏—è
- –õ–µ–≥–∫–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ã–µ –∏—Å–∫–∞–∂–µ–Ω–∏—è

## üîß –û—Ç–ª–∞–¥–∫–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

#### 1. –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ transformers

```
‚ö†Ô∏è Transformers –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install transformers torch torchvision
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install transformers torch torchvision pillow
```

#### 2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏

```
RuntimeError: CUDA out of memory
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à–∏–π batch_size
- –û—Ç–∫–ª—é—á–∏—Ç–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

#### 3. –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏

```
ValueError: –¢–µ–∫—Å—Ç —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π: 250 —Å–∏–º–≤–æ–ª–æ–≤ (–º–∞–∫—Å: 200)
```

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á—å—Ç–µ `max_text_length` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –û—á–∏—Å—Ç–∏—Ç–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤

#### 4. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```
FileNotFoundError: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: image.jpg
```

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç–∏ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
- –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π

### –†–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏

```python
import logging

# –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.DEBUG)

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–ø–∞—Ä–∞—Ç–æ—Ä–∞ —Å –æ—Ç–ª–∞–¥–∫–æ–π
preparator = TrOCRDatasetPreparator(config)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
dataset = preparator.load_prepared_dataset("path/to/dataset", "train")

print(f"–†–∞–∑–º–µ—Ä –¥–∞—Ç–∞—Å–µ—Ç–∞: {len(dataset)}")

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
sample = dataset[0]
print(f"–§–æ—Ä–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: {sample['pixel_values'].shape}")
print(f"–§–æ—Ä–º–∞ –º–µ—Ç–æ–∫: {sample['labels'].shape}")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
info = preparator.get_dataset_info("path/to/dataset")
print(info['statistics'])
```

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–±—É—á–µ–Ω–∏–µ–º

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ TrOCR Trainer

```python
from app.training.trocr_trainer import TrOCRTrainer

# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
train_dataset = preparator.load_prepared_dataset("path/to/dataset", "train")
val_dataset = preparator.load_prepared_dataset("path/to/dataset", "validation")

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–Ω–µ—Ä–∞
trainer = TrOCRTrainer(
    model_name="microsoft/trocr-base-stage1",
    train_dataset=train_dataset,
    val_dataset=val_dataset
)

# –û–±—É—á–µ–Ω–∏–µ
trainer.train(
    output_dir="models/my_trocr_model",
    num_epochs=5,
    batch_size=8
)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

–î–∞—Ç–∞—Å–µ—Ç—ã TrOCR –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å —Å–∏—Å—Ç–µ–º–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ InvoiceGemini:

- üìä –ú–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üìà –ì—Ä–∞—Ñ–∏–∫–∏ loss –∏ accuracy
- üìù –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –æ–±—É—á–µ–Ω–∏—è
- üíæ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [TrOCR Paper](https://arxiv.org/abs/2109.10282) - –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è Microsoft
- [Hugging Face TrOCR](https://huggingface.co/docs/transformers/model_doc/trocr) - –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Fine-tuning Guide](https://learnopencv.com/fine-tuning-trocr-training-trocr-to-recognize-curved-text/) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ fine-tuning

### –ü—Ä–∏–º–µ—Ä—ã –¥–∞—Ç–∞—Å–µ—Ç–æ–≤
- SCUT-CTW1500 - –∏–∑–æ–≥–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
- IAM Handwriting Database - —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç  
- FUNSD - –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ñ–æ—Ä–º
- CORD - receipts (—á–µ–∫–∏)

### –°–æ–æ–±—â–µ—Å—Ç–≤–æ
- [Hugging Face Forums](https://discuss.huggingface.co/c/transformers/9) - –û–±—Å—É–∂–¥–µ–Ω–∏—è TrOCR
- [Microsoft Research](https://www.microsoft.com/en-us/research/publication/trocr-transformer-based-optical-character-recognition-with-pre-trained-models/) - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è Microsoft

---

## ‚≠ê –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ TrOCR –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ –∏ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è TrOCR –º–æ–¥–µ–ª–µ–π. 

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- üöÄ –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üîß –ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è  
- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- üé® –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
- üíæ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PyTorch
- üîç –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

–£—Å–ø–µ—à–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è! üéâ 