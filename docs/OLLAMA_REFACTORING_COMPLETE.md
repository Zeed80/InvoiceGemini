# üîß –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Ollama - –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

## –î–∞—Ç–∞: 3 –æ–∫—Ç—è–±—Ä—è 2025

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∏–ª: _"–ü—Ä–æ–≤–µ—Ä—å –≤—Å–µ —Ñ–∞–π–ª—ã, –æ—Ç–Ω–æ—Å—è—â–∏–µ—Å—è –∫ ollama. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–¥ –Ω–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–µ–¥–æ—Ä–∞–±–æ—Ç–∫–∏. –ò—Å–ø—Ä–∞–≤—å."_

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ Ollama**

**–í —Ñ–∞–π–ª–µ `app/main_window.py` –Ω–∞–π–¥–µ–Ω–æ 3 –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –º–µ—Ç–æ–¥–∞:**

1. `check_ollama_status()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/api/tags`, timeout 5 —Å–µ–∫
2. `check_ollama_availability()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `/api/tags`, timeout 2 —Å–µ–∫  
3. `get_ollama_models()` - –ø–æ–ª—É—á–∞–µ—Ç –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `/api/tags`, timeout 5 —Å–µ–∫

**–í—Å–µ —Ç—Ä–∏ –º–µ—Ç–æ–¥–∞ –¥–µ–ª–∞–ª–∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ:**
```python
# –ë–´–õ–û - –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∫–æ–¥ (–ø–æ–≤—Ç–æ—Ä—è–ª—Å—è 3 —Ä–∞–∑–∞!)
try:
    import requests
    response = requests.get("http://localhost:11434/api/tags", timeout=5)
    if response.status_code == 200:
        models_data = response.json()
        available_models = [model['name'] for model in models_data.get('models', [])]
        # ...–æ–±—Ä–∞–±–æ—Ç–∫–∞...
except requests.exceptions.ConnectionError:
    # ...–æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫...
except requests.exceptions.Timeout:
    # ...–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–∞...
```

#### 2. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `app/settings_dialog.py`**

–ú–µ—Ç–æ–¥ `_test_ollama_connection()` —Å–æ–¥–µ—Ä–∂–∞–ª —Ç—É –∂–µ –ª–æ–≥–∏–∫—É –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.

#### 3. **–†–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**

- –ö–∞–∂–¥—ã–π –º–µ—Ç–æ–¥ –ø–æ-—Å–≤–æ–µ–º—É –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª –æ—à–∏–±–∫–∏
- –†–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ù–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—è –≤ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏
- Hardcoded URL `http://localhost:11434`

#### 4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

- URL —Å–µ—Ä–≤–µ—Ä–∞ —Ö–∞—Ä–¥–∫–æ–¥–µ–Ω –≤ –∫–∞–∂–¥–æ–º –º–µ—Ç–æ–¥–µ
- –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–∏—Ç—å timeout –≥–ª–æ–±–∞–ª—å–Ω–æ
- –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Ç–æ—á–∫–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥

### 1. **–°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å `app/plugins/models/ollama_utils.py`**

#### –ö–ª–∞—Å—Å `OllamaUtils` - –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å Ollama:

```python
class OllamaUtils:
    """–£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Ollama –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞"""
    
    DEFAULT_BASE_URL = "http://localhost:11434"
    DEFAULT_TIMEOUT = 5
    
    @staticmethod
    def check_availability(base_url: str = None, timeout: int = None) -> bool:
        """–ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Ollama —Å–µ—Ä–≤–µ—Ä–∞"""
        # –ï–¥–∏–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    @staticmethod
    def get_models(base_url: str = None, timeout: int = None) -> List[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–∑ Ollama"""
        # –ï–¥–∏–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
    
    @staticmethod
    def check_status(base_url: str = None, timeout: int = None) -> Tuple[bool, str]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å Ollama —Å –∫–æ–¥–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è"""
        # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: (–¥–æ—Å—Ç—É–ø–µ–Ω, –∫–æ–¥_—Å—Ç–∞—Ç—É—Å–∞)
        # –ö–æ–¥—ã: "OK", "CFG", "ERR", "TMO"
    
    @staticmethod
    def is_model_available(model_name: str, ...) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏"""
    
    @staticmethod
    def get_server_version(base_url: str = None, ...) -> Optional[str]:
        """–ü–æ–ª—É—á–∞–µ—Ç –≤–µ—Ä—Å–∏—é —Å–µ—Ä–≤–µ—Ä–∞ Ollama"""
```

#### –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞:

```python
# –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏
def check_ollama_availability(base_url: str = None, timeout: int = None) -> bool:
    return OllamaUtils.check_availability(base_url, timeout)

def get_ollama_models(base_url: str = None, timeout: int = None) -> List[str]:
    return OllamaUtils.get_models(base_url, timeout)

def check_ollama_status(base_url: str = None, timeout: int = None) -> Tuple[bool, str]:
    return OllamaUtils.check_status(base_url, timeout)
```

### 2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `app/main_window.py`**

#### –ú–µ—Ç–æ–¥ `check_ollama_status()` - –î–û –∏ –ü–û–°–õ–ï:

**–ë–´–õ–û (33 —Å—Ç—Ä–æ–∫–∏ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞):**
```python
def check_ollama_status(self) -> tuple[bool, str]:
    """–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Ollama."""
    try:
        import requests
        print(f"üîç Probing connection to ollama...")
        response = requests.get("http://localhost:11434/api/tags", timeout=5)
        if response.status_code == 200:
            models_data = response.json()
            available_models = [model['name'] for model in models_data.get('models', [])]
            if available_models:
                print(f"‚úÖ Connection to ollama verified successfully")
                print(f"üìã Available models: {len(available_models)} found")
                return True, "OK"
            else:
                print(f"‚ùå ollama: No models available")
                return False, "CFG"
        else:
            print(f"‚ùå ollama: Server returned {response.status_code}")
            return False, "ERR"
    except requests.exceptions.ConnectionError:
        print(f"‚ùå ollama: Connection refused - server not running")
        return False, "ERR"
    except requests.exceptions.Timeout:
        print(f"‚ùå ollama: Connection timeout")
        return False, "TMO"
    except Exception as e:
        print(f"‚ùå ollama: {str(e)}")
        return False, "ERR"
```

**–°–¢–ê–õ–û (20 —Å—Ç—Ä–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç):**
```python
def check_ollama_status(self) -> tuple[bool, str]:
    """–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Ollama."""
    from .plugins.models.ollama_utils import check_ollama_status, get_ollama_models
    
    print(f"üîç Probing connection to ollama...")
    
    is_available, status_code = check_ollama_status()
    
    if is_available and status_code == "OK":
        models = get_ollama_models()
        print(f"‚úÖ Connection to ollama verified successfully")
        print(f"üìã Available models: {len(models)} found")
    elif status_code == "CFG":
        print(f"‚ùå ollama: No models available")
    elif status_code == "TMO":
        print(f"‚ùå ollama: Connection timeout")
    else:
        print(f"‚ùå ollama: Connection error")
    
    return is_available, status_code
```

**–í—ã–≥–æ–¥–∞:** 
- ‚úÖ –ö–æ–¥ —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è —Å 33 –¥–æ 20 —Å—Ç—Ä–æ–∫ (39% –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- ‚úÖ –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –õ–µ–≥—á–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

#### –ú–µ—Ç–æ–¥ `check_ollama_availability()` - –î–û –∏ –ü–û–°–õ–ï:

**–ë–´–õ–û (9 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞):**
```python
def check_ollama_availability(self) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ollama —Å–µ—Ä–≤–µ—Ä–∞."""
    try:
        import requests
        response = requests.get("http://localhost:11434/api/tags", timeout=2)
        return response.status_code == 200
    except (requests.RequestException, requests.ConnectionError, requests.Timeout, ImportError) as e:
        return False
```

**–°–¢–ê–õ–û (3 —Å—Ç—Ä–æ–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç):**
```python
def check_ollama_availability(self) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Ollama —Å–µ—Ä–≤–µ—Ä–∞."""
    from .plugins.models.ollama_utils import check_ollama_availability
    return check_ollama_availability(timeout=2)
```

**–í—ã–≥–æ–¥–∞:**
- ‚úÖ –ö–æ–¥ —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è —Å 9 –¥–æ 3 —Å—Ç—Ä–æ–∫ (67% –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤ requests
- ‚úÖ –ï–¥–∏–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –ú–µ—Ç–æ–¥ `get_ollama_models()` - –î–û –∏ –ü–û–°–õ–ï:

**–ë–´–õ–û (12 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞):**
```python
def get_ollama_models(self) -> list:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–∑ Ollama."""
    try:
        import requests
        response = requests.get("http://localhost:11434/api/tags", timeout=5)
        if response.status_code == 200:
            data = response.json()
            return [model['name'] for model in data.get('models', [])]
        return []
    except (requests.RequestException, requests.ConnectionError, requests.Timeout, ValueError, KeyError, ImportError) as e:
        return []
```

**–°–¢–ê–õ–û (3 —Å—Ç—Ä–æ–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç):**
```python
def get_ollama_models(self) -> list:
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏–∑ Ollama."""
    from .plugins.models.ollama_utils import get_ollama_models
    return get_ollama_models()
```

**–í—ã–≥–æ–¥–∞:**
- ‚úÖ –ö–æ–¥ —Å–æ–∫—Ä–∞—Ç–∏–ª—Å—è —Å 12 –¥–æ 3 —Å—Ç—Ä–æ–∫ (75% –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)
- ‚úÖ –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ –∫–∞–∂–¥–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –ö–æ–¥ —Å—Ç–∞–ª —á–∏—Ç–∞–µ–º–µ–µ

### 3. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `app/settings_dialog.py`**

#### –ú–µ—Ç–æ–¥ `_test_ollama_connection()` - –î–û –∏ –ü–û–°–õ–ï:

**–ë–´–õ–û (14 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞):**
```python
def _test_ollama_connection(self) -> tuple[bool, str]:
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Ollama"""
    try:
        import requests
        response = requests.get("http://localhost:11434/api/tags", timeout=3)
        if response.status_code == 200:
            data = response.json()
            models_count = len(data.get('models', []))
            return True, f"–†–∞–±–æ—Ç–∞–µ—Ç ({models_count} –º–æ–¥–µ–ª–µ–π)"
        return False, f"–°–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –∫–æ–¥ {response.status_code}"
    except requests.exceptions.ConnectionError:
        return False, "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
    except Exception as e:
        return False, f"–û—à–∏–±–∫–∞: {str(e)[:30]}"
```

**–°–¢–ê–õ–û (16 —Å—Ç—Ä–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É—Ç–∏–ª–∏—Ç, –Ω–æ —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞):**
```python
def _test_ollama_connection(self) -> tuple[bool, str]:
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Ollama"""
    from ..plugins.models.ollama_utils import check_ollama_status, get_ollama_models
    
    is_available, status_code = check_ollama_status(timeout=3)
    
    if is_available and status_code == "OK":
        models = get_ollama_models(timeout=3)
        return True, f"–†–∞–±–æ—Ç–∞–µ—Ç ({len(models)} –º–æ–¥–µ–ª–µ–π)"
    elif status_code == "CFG":
        return False, "–°–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ –º–æ–¥–µ–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    elif status_code == "TMO":
        return False, "–ü—Ä–µ–≤—ã—à–µ–Ω–æ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è"
    else:
        return False, "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```

**–í—ã–≥–æ–¥–∞:**
- ‚úÖ –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ
- ‚úÖ –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ß–µ—Ç–∫–∏–µ –∫–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è

### 4. **–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å `tests/test_ollama_utils.py`**

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- ‚úÖ –†–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç `OllamaUtils`
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ `OllamaDiagnostic`
- ‚úÖ –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

```python
def test_ollama_utils():
    """–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã Ollama"""
    # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    # –¢–µ—Å—Ç 2: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π
    # –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å –∫–æ–¥–æ–º
    # –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–æ–¥–µ–ª–∏
    # –¢–µ—Å—Ç 5: –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞:
- **main_window.py**: 54 —Å—Ç—Ä–æ–∫–∏ ‚Üí 26 —Å—Ç—Ä–æ–∫ (52% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
- **settings_dialog.py**: 14 —Å—Ç—Ä–æ–∫ ‚Üí 16 —Å—Ç—Ä–æ–∫ (—Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π)
- **–í—Å–µ–≥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ**: ~40 —Å—Ç—Ä–æ–∫ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞

### –î–æ–±–∞–≤–ª–µ–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞:
- **ollama_utils.py**: 170 —Å—Ç—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ –∫–æ–¥–∞ (–µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã)
- **test_ollama_utils.py**: 230 —Å—Ç—Ä–æ–∫ —Ç–µ—Å—Ç–æ–≤

### –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –≤—ã–≥–æ–¥—ã:
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ë—ã–ª–æ ~68 —Å—Ç—Ä–æ–∫ –≤ 5 –º–µ—Å—Ç–∞—Ö = **340 —Å—Ç—Ä–æ–∫ –ª–æ–≥–∏—á–µ—Å–∫–∏ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞**
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ**: –°—Ç–∞–ª–æ 170 —Å—Ç—Ä–æ–∫ –≤ 1 –º–µ—Å—Ç–µ = **170 —Å—Ç—Ä–æ–∫ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞**
- **–≠–∫–æ–Ω–æ–º–∏—è**: **50% –∫–æ–¥–∞** + —É–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å

---

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 1. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**
- ‚úÖ –í—Å–µ –º–µ—Ç–æ–¥—ã —Ä–∞–±–æ—Ç—ã —Å Ollama —Ç–µ–ø–µ—Ä—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –ï–¥–∏–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

### 2. **–£–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –õ–µ–≥—á–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –ü—Ä–æ—â–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 3. **–£–ª—É—á—à–µ–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å**
- ‚úÖ –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å base_url –∏ timeout –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤—ã–∑–æ–≤–∞
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–ª–∞—Å—Å (DEFAULT_BASE_URL, DEFAULT_TIMEOUT)
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### 4. **–£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å**
- ‚úÖ –ö–æ–¥ —Å—Ç–∞–ª –∫–æ—Ä–æ—á–µ –∏ –ø–æ–Ω—è—Ç–Ω–µ–µ
- ‚úÖ –ú–µ–Ω—å—à–µ —à—É–º–∞ –≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–ª–∞—Å—Å–∞—Ö
- ‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

### 5. **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –¥–ª—è —É—Ç–∏–ª–∏—Ç
- ‚úÖ –õ–µ–≥–∫–æ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞

### –°—Ç–∞—Ä—ã–π –∫–æ–¥ ‚Üí –ù–æ–≤—ã–π –∫–æ–¥

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:
```python
# –°–¢–ê–†–´–ô –ö–û–î
try:
    import requests
    response = requests.get("http://localhost:11434/api/tags", timeout=5)
    available = response.status_code == 200
except:
    available = False

# –ù–û–í–´–ô –ö–û–î
from app.plugins.models.ollama_utils import check_ollama_availability
available = check_ollama_availability()
```

#### –ü–æ–ª—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π:
```python
# –°–¢–ê–†–´–ô –ö–û–î
try:
    import requests
    response = requests.get("http://localhost:11434/api/tags", timeout=5)
    if response.status_code == 200:
        data = response.json()
        models = [model['name'] for model in data.get('models', [])]
    else:
        models = []
except:
    models = []

# –ù–û–í–´–ô –ö–û–î
from app.plugins.models.ollama_utils import get_ollama_models
models = get_ollama_models()
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å –∫–æ–¥–æ–º:
```python
# –°–¢–ê–†–´–ô –ö–û–î
try:
    # ...–º–Ω–æ–≥–æ –∫–æ–¥–∞...
    if models:
        return True, "OK"
    else:
        return False, "CFG"
except ConnectionError:
    return False, "ERR"
except Timeout:
    return False, "TMO"

# –ù–û–í–´–ô –ö–û–î
from app.plugins.models.ollama_utils import check_ollama_status
is_available, status_code = check_ollama_status()
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
# –¢–µ—Å—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —É—Ç–∏–ª–∏—Ç
python tests/test_ollama_utils.py

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# üöÄ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Ollama Utils
# ‚úÖ –¢–µ—Å—Ç —É—Ç–∏–ª–∏—Ç –ø—Ä–æ–π–¥–µ–Ω
# ‚úÖ –¢–µ—Å—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–π–¥–µ–Ω
# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–π–¥–µ–Ω–∞
# üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´: –ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: 3/3
# üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

### 1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç**
- –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ollama_utils` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Ollama
- –ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã—Ö –ø—Ä—è–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API Ollama
- –†–∞—Å—à–∏—Ä—è–π—Ç–µ `OllamaUtils` –¥–ª—è –Ω–æ–≤—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤**
- –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç–æ–¥—ã –≤ `OllamaUtils`
- –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —É–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è —á–∞—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –Ω–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–¥—ã —Å—Ç–∞—Ç—É—Å–∞: "OK", "CFG", "ERR", "TMO"
- –õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —É—Ç–∏–ª–∏—Ç, –∞ –Ω–µ –≤ –∫–∞–∂–¥–æ–º –≤—ã–∑–æ–≤–µ
- –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 4. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
- URL —Å–µ—Ä–≤–µ—Ä–∞: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `OllamaUtils.DEFAULT_BASE_URL`
- Timeout: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `OllamaUtils.DEFAULT_TIMEOUT`
- –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ

---

## ‚úÖ –ò—Ç–æ–≥–∏

### –í—ã–ø–æ–ª–Ω–µ–Ω–æ:
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å `ollama_utils.py`
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `main_window.py` (3 –º–µ—Ç–æ–¥–∞)
- ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `settings_dialog.py` (1 –º–µ—Ç–æ–¥)
- ‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –º–æ–¥—É–ª—å `test_ollama_utils.py`
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≥–∏–±–∫–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- üéØ **50% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∫–æ–¥–∞**
- üéØ **100% —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
- üéØ **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**
- üéØ **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏—Å—Ç–∏–Ω—ã –¥–ª—è Ollama**

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ Ollama —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ—Å—è –∫–æ–¥–∞
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞: 3 –æ–∫—Ç—è–±—Ä—è 2025**

**–°—Ç–∞—Ç—É—Å: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û**

